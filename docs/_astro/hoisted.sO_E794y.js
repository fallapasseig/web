class l{constructor(t){if(this.target="string"==typeof t.target?document.querySelector(t.target):t.target,!this.target)throw new Error("Target element not found");this.images=t.images||[],this.duration=t.duration||800,this.bufferSize=t.bufferSize||4,this.destroyed=!1,this.boundKeyDown=this.handleKeyDown.bind(this),this.boundClickHandler=this.handleClick.bind(this),this.opts=t,this.singlePage=!0===t.singlePage,this.useKeyboard=!1!==t.useKeyboard,this.sheetCount=Math.ceil(this.images.length/2),this.sheetElements=new Map,this.currentPage=1,this.bookWidth=t.width||800,this.bookHeight=t.height||600,this.init(),this.useKeyboard&&document.addEventListener("keydown",this.boundKeyDown),!t.width&&!t.height&&this.images.length>0&&this.detectRatio(),this.resizeObserver=new ResizeObserver((()=>this.resize())),this.resizeObserver.observe(this.target)}detectRatio(){const t=new Image;t.onload=()=>{if(this.destroyed)return;const e=t.naturalWidth/t.naturalHeight;this.bookHeight=1e3,this.bookWidth=2*this.bookHeight*e,this.book&&(this.book.style.width=`${this.bookWidth}px`,this.book.style.height=`${this.bookHeight}px`),this.updateState(),this.resize()},t.src=this.images[0]}handleKeyDown(t){"ArrowRight"===t.key?this.nextPage():"ArrowLeft"===t.key&&this.prevPage()}handleClick(t){const e=this.target.getBoundingClientRect();t.clientX-e.left<e.width/2?this.prevPage():this.nextPage()}createSheet(t){if(this.sheetElements.has(t))return;const e=document.createElement("div");e.classList.add("flipbook-page"),e.setAttribute("data-sheet-index",t);const g=2*t,s=2*t+1,n=document.createElement("div");n.classList.add("flipbook-page-front"),this.images[g]&&(n.style.backgroundImage=`url('${this.images[g]}')`);const i=document.createElement("div");i.classList.add("flipbook-page-back"),this.images[s]&&(i.style.backgroundImage=`url('${this.images[s]}')`),e.appendChild(n),e.appendChild(i);t<this.getSheetsToFlipCount()&&e.classList.add("flipped");const p=this.book.querySelectorAll(".flipbook-page");let h=!1;for(const g of p)if(parseInt(g.getAttribute("data-sheet-index"),10)>t){this.book.insertBefore(e,g),h=!0;break}h||this.book.appendChild(e),this.sheetElements.set(t,{sheet:e,front:n,back:i})}removeSheet(t){const e=this.sheetElements.get(t);e&&(e.sheet.remove(),this.sheetElements.delete(t))}updateVirtualWindow(){const t=Math.floor((this.currentPage-1)/2),e=Math.max(0,t-this.bufferSize),g=Math.min(this.sheetCount-1,t+this.bufferSize);for(const t of this.sheetElements.keys())(t<e||t>g)&&this.removeSheet(t);for(let t=e;t<=g;t++)this.createSheet(t)}getSheetsToFlipCount(){return this.currentPage%2!=0?Math.floor((this.currentPage-1)/2):Math.floor((this.currentPage-1)/2)+1}init(){this.target.classList.add("flipbook-stage"),this.book=document.createElement("div"),this.book.classList.add("flipbook-book"),this.book.style.width=`${this.bookWidth}px`,this.book.style.height=`${this.bookHeight}px`,this.book.style.setProperty("--page-duration",`${this.duration}ms`),this.target.appendChild(this.book),this.target.addEventListener("click",this.boundClickHandler),this.updateState(),this.resize()}setSinglePageMode(t){this.singlePage!==t&&(this.singlePage=t,this.updateState(),this.resize())}resize(){const t=this.target.clientWidth,e=this.target.clientHeight;if(!t||!e)return;const g=t<1800;let s,n;"auto"===this.opts.singlePage?g!==this.singlePage&&(this.singlePage=g,this.target.classList.toggle("single-page",this.singlePage),this.target.classList.toggle("double-page",!this.singlePage),this.updateState()):g&&!this.singlePage?(this.singlePage=!0,this.target.classList.toggle("single-page",this.singlePage),this.target.classList.toggle("double-page",!this.singlePage),this.updateState()):g||"auto"===this.opts.singlePage||this.singlePage===this.opts.singlePage?(this.target.classList.toggle("single-page",this.singlePage),this.target.classList.toggle("double-page",!this.singlePage)):(this.singlePage=!0===this.opts.singlePage,this.target.classList.toggle("single-page",this.singlePage),this.target.classList.toggle("double-page",!this.singlePage),this.updateState()),this.singlePage?(s=this.bookWidth/2,n=this.bookHeight):(s=this.bookWidth,n=this.bookHeight);const i=t/s,p=e/n;let h;h=this.singlePage?i:.95*Math.min(i,p),this.currentScale=h,this.updateTransform()}updateTransform(){const t=this.currentPanX||0;this.book.style.transform=`scale(${this.currentScale}) translateX(${t}px)`}nextPage(){this.singlePage?this.currentPage<this.images.length&&(this.currentPage++,this.updateState()):(1===this.currentPage?this.currentPage=2:this.currentPage+2<=this.images.length?this.currentPage+=2:this.currentPage<this.images.length&&this.currentPage%2==0&&(this.currentPage+=1),this.updateState())}prevPage(){this.singlePage?this.currentPage>1&&(this.currentPage--,this.updateState()):this.currentPage>2?(this.currentPage-=2,this.currentPage<1&&(this.currentPage=1),this.updateState()):2===this.currentPage&&(this.currentPage=1,this.updateState())}goToPage(t){this.currentPage=Math.max(1,Math.min(t,this.images.length)),this.updateState()}updateState(){const t=this.getSheetsToFlipCount();this.updateVirtualWindow();for(const[e,g]of this.sheetElements)e<t?g.sheet.classList.add("flipped"):g.sheet.classList.remove("flipped");this.updateZIndexes(),this.singlePage?this.currentPage%2==0?this.currentPanX=this.bookWidth/4:this.currentPanX=-this.bookWidth/4:1===this.currentPage?this.currentPanX=-this.bookWidth/4:this.currentPage===this.images.length&&this.currentPage%2==0?this.currentPanX=this.bookWidth/4:this.currentPanX=0,this.updateTransform()}updateZIndexes(){const t=this.sheetCount;for(const[e,g]of this.sheetElements)g.sheet.classList.contains("flipped")?g.sheet.style.zIndex=e+1:g.sheet.style.zIndex=t-e}destroy(){this.destroyed||(this.destroyed=!0,this.resizeObserver&&this.resizeObserver.disconnect(),this.useKeyboard&&document.removeEventListener("keydown",this.boundKeyDown),this.target&&this.target.removeEventListener("click",this.boundClickHandler),this.target&&this.book&&this.target.removeChild(this.book),this.sheetElements.clear(),this.sheetElements=null,this.images=null,this.book=null,this.target=null,this.boundKeyDown=null,this.boundClickHandler=null,this.resizeObserver=null)}}const d="https://media.githubusercontent.com/media/fallapasseig/static/main/llibret-2025/",c=["0000.jpg","0001.png","0002.png","0003.png","0004.png","0005.png","0006.png","0007.png","0008.png","0009.png","0010.png","0011.png","0012.png","0013.png","0014.png","0015.png","0016.png","0017.png","0018.png","0019.png","0020.png","0021.png","0022.png","0023.jpg","0024.jpg","0025.png","0026.png","0027.png","0028.png","0029.png","0030.png","0031.png","0032.png","0033.png","0034.png","0035.jpg","0036.jpg","0037.jpg","0038.jpg","0039.png","0040.png","0041.png","0042.jpg","0043.png","0044.png","0045.png","0046.jpg","0047.png","0048.jpg","0049.png","0050.png","0051.png","0052.png","0053.png","0054.png","0055.png","0056.png","0057.png","0058.png","0059.png","0060.png","0061.png","0062.png","0063.png","0064.png","0065.png","0066.png","0067.png","0068.png","0069.png","0070.png","0071.png","0072.png","0073.png","0074.jpg","0075.jpg","0076.png","0077.png","0078.png","0079.png","0080.jpg","0081.png","0082.png","0083.png","0084.png","0085.png","0086.png","0087.png","0088.png","0089.png","0090.png","0091.png","0092.png","0093.png","0094.png","0095.png","0096.png","0097.png","0098.png","0099.png","0100.png","0101.png","0102.png","0103.png","0104.png","0105.png","0106.png","0107.jpg","0108.png","0109.png","0110.png","0111.png","0112.png","0113.png","0114.png","0115.png","0116.jpg","0117.png","0118.jpg","0119.png","0120.jpg","0121.png","0122.png","0123.png","0124.jpg","0125.png","0126.jpg","0127.png","0128.png","0129.png","0130.jpg","0131.png","0132.jpg","0133.png","0134.png","0135.png","0136.png","0137.png","0138.jpg","0139.png","0140.png","0141.jpg","0142.jpg","0143.jpg","0144.jpg","0145.jpg","0146.jpg","0147.jpg","0148.jpg","0149.jpg","0150.jpg","0151.jpg","0152.jpg","0153.jpg","0154.jpg","0155.jpg","0156.jpg","0157.jpg","0158.jpg","0159.jpg","0160.jpg","0161.jpg","0162.jpg","0163.jpg","0164.jpg","0165.jpg","0166.jpg","0167.jpg","0168.jpg","0169.jpg","0170.jpg","0171.jpg","0172.jpg","0173.jpg","0174.jpg","0175.jpg","0176.jpg","0177.jpg","0178.jpg","0179.jpg","0180.jpg","0181.png","0182.png","0183.jpg","0184.jpg","0185.jpg","0186.jpg","0187.jpg","0188.jpg","0189.png","0190.png","0191.png","0192.png","0193.jpg","0194.jpg","0195.jpg","0196.jpg","0197.jpg","0198.jpg","0199.png","0200.jpg","0201.jpg","0202.png","0203.png","0204.png","0205.png","0206.png","0207.png","0208.png","0209.png","0210.png","0211.png","0212.png","0213.png","0214.png","0215.png","0216.png","0217.png","0218.png","0219.png","0220.png","0221.png","0222.png","0223.png","0224.png","0225.png","0226.png","0227.png","0228.png","0229.png","0230.png","0231.png","0232.png","0233.png","0234.jpg","0235.png","0236.jpg","0237.jpg","0238.png","0239.png","0240.jpg","0241.jpg","0242.png","0243.jpg","0244.jpg","0245.png","0246.jpg","0247.png","0248.png","0249.png","0250.png","0251.jpg","0252.png","0253.png","0254.png","0255.jpg","0256.png","0257.jpg","0258.jpg","0259.png","0260.jpg","0261.png","0262.png","0263.png","0264.png","0265.jpg","0266.png","0267.jpg"],u=c.map((t=>d+t)),f=new l({target:"#my-flipbook",images:u,duration:600,singlePage:"auto"});window.book=f;