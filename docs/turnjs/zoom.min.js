!function(t){function o(t,e){return t[0]!=e[0]&&(!!t.attr("page")||!!t.parent()[0]&&o(t.parent(),e))}function e(t){function o(t){this.name="TurnJsError",this.message=t}return o.prototype=Error(),o.prototype.constructor=o,new o(t)}function i(t,o,e){return a&&e?" translate3d("+t+"px,"+o+"px, 0px) ":" translate("+t+"px, "+o+"px) "}function n(t,o){return a&&o?" scale3d("+t+", "+t+", 1) ":" scale("+t+") "}function s(t,o){return{x:t,y:o}}function r(t,o){return function(){return t.apply(o,arguments)}}var a,u={max:2,flipbook:null,easeFunction:"ease-in-out",duration:500,when:{}},h={init:function(o){var i=this,n=this.data();if(!(o=t.extend({},u,o)).flipbook||!o.flipbook.turn("is"))throw e("options.flipbook is required");if(a="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,"function"!=typeof o.max){var l=o.max;o.max=function(){return l}}for(var p in n.zoom={opts:o,axis:s(0,0),scrollPos:s(0,0),eventQueue:[],mouseupEvent:function(){return h._eMouseUp.apply(i,arguments)},eventTouchStart:r(h._eTouchStart,i),eventTouchMove:r(h._eTouchMove,i),eventTouchEnd:r(h._eTouchEnd,i),flipbookEvents:{zooming:r(h._eZoom,i),pressed:r(h._ePressed,i),released:r(h._eReleased,i),start:r(h._eStart,i),turning:r(h._eTurning,i),turned:r(h._eTurned,i),destroying:r(h._eDestroying,i)}},o.when)Object.prototype.hasOwnProperty.call(o.when,p)&&this.bind("zoom."+p,o.when[p]);for(p in n.zoom.flipbookEvents)Object.prototype.hasOwnProperty.call(n.zoom.flipbookEvents,p)&&o.flipbook.bind(p,n.zoom.flipbookEvents[p]);this.css({position:"relative",overflow:"hidden"}),t.isTouch?(o.flipbook.bind("touchstart",n.zoom.eventTouchStart).bind("touchmove",n.zoom.eventTouchMove).bind("touchend",n.zoom.eventTouchEnd),this.bind("touchstart",h._tap)):this.mousedown(h._mousedown).click(h._tap)},_tap:function(e){var i=t(this),n=i.data().zoom;!n.draggingCorner&&!n.dragging&&o(t(e.target),i)&&(h._addEvent.call(i,"tap",e),(e=h._eventSeq.call(i))&&i.trigger(e))},_addEvent:function(t,o){var e=this.data().zoom,i=(new Date).getTime();e.eventQueue.push({name:t,timestamp:i,event:o}),10<e.eventQueue.length&&e.eventQueue.splice(0,1)},_eventSeq:function(){var o=this.data().zoom.eventQueue,e=o.length-1;return 0<e&&"tap"==o[e].name&&"tap"==o[e-1].name&&o[e].event.pageX==o[e-1].event.pageX&&o[e].event.pageY==o[e-1].event.pageY&&200>o[e].timestamp-o[e-1].timestamp&&50<o[e].timestamp-o[e-1].timestamp?t.extend(o[e].event,{type:"zoom.doubleTap"}):"tap"==o[e].name?t.extend(o[e].event,{type:"zoom.tap"}):void 0},_prepareZoom:function(){var o,e=0,i=this.data().zoom,n=1/this.zoom("value"),r=(o=i.opts.flipbook).turn("direction"),a=o.data(),u=o.offset(),h=this.offset(),l={height:o.height()},p=o.turn("view");if("double"==o.turn("display")&&o.data().opts.autoCenter?p[0]?p[1]?(l.width=o.width(),o=s(u.left-h.left,u.top-h.top)):(l.width=o.width()/2,e="ltr"==r?0:l.width,o=s("ltr"==r?u.left-h.left:u.left-h.left+l.width,u.top-h.top)):(l.width=o.width()/2,e="ltr"==r?l.width:0,o=s("ltr"==r?u.left-h.left+l.width:u.left-h.left,u.top-h.top)):(l.width=o.width(),o=s(u.left-h.left,u.top-h.top)),i.zoomer||(i.zoomer=t("<div />",{class:"zoomer",css:{overflow:"hidden",position:"absolute",zIndex:"1000000"}}).mousedown((function(){return!1})).appendTo(this)),i.zoomer.css({top:o.y,left:o.x,width:l.width,height:l.height}),(r=p.join(","))!=i.zoomerView)for(i.zoomerView=r,i.zoomer.find("*").remove(),r=0;r<p.length;r++)if(p[r]){h=a.pageObjs[p[r]].offset();var d=t(a.pageObjs[p[r]]);d.clone().transform("").css({width:d.width()*n,height:d.height()*n,position:"absolute",display:"",top:(h.top-u.top)*n,left:(h.left-u.left-e)*n}).appendTo(i.zoomer)}return{pos:o,size:l}},value:function(){return this.data().zoom.opts.flipbook.turn("zoom")},zoomIn:function(o){var e=this,r=this.data().zoom,a=r.opts.flipbook,u=r.opts.max();a.offset();var l=this.offset();if(r.zoomIn)return this;a.turn("stop");var p=t.Event("zoom.change");if(this.trigger(p,[u]),p.isDefaultPrevented())return this;var d=(v=h._prepareZoom.call(this)).pos,c=s(v.size.width/2,v.size.height/2),m=(p=t.cssPrefix(),t.cssTransitionEnd()),f=a.data().opts.autoCenter;r.scale=u,a.data().noCenter=!0,(0>(o=void 0!==o?"x"in o&&"y"in o?s(o.x-d.x,o.y-d.y):t.isTouch?s(o.originalEvent.touches[0].pageX-d.x-l.left,o.originalEvent.touches[0].pageY-d.y-l.top):s(o.pageX-d.x-l.left,o.pageY-d.y-l.top):s(c.x,c.y)).x||0>o.y||o.x>v.width||o.y>v.height)&&(o.x=c.x,o.y=c.y);var g=s((o.x-c.x)*u+c.x,(o.y-c.y)*u+c.y),v=(o=s(v.size.width*u>this.width()?o.x-g.x:0,v.size.height*u>this.height()?o.y-g.y:0),g=s(Math.abs(v.size.width*u-this.width()),Math.abs(v.size.height*u-this.height())),s(Math.min(0,v.size.width*u-this.width()),Math.min(0,v.size.height*u-this.height()))),x=s(c.x*u-c.x-d.x-o.x,c.y*u-c.y-d.y-o.y);x.y>g.y?o.y=x.y-g.y+o.y:x.y<v.y&&(o.y=x.y-v.y+o.y),x.x>g.x?o.x=x.x-g.x+o.x:x.x<v.x&&(o.x=x.x-v.x+o.x),x=s(c.x*u-c.x-d.x-o.x,c.y*u-c.y-d.y-o.y),(d={})[p+"transition"]=p+"transform "+r.opts.easeFunction+" "+r.opts.duration+"ms";var z=function(){e.trigger("zoom.zoomIn"),r.zoomIn=!0,r.flipPosition=s(a.css("left"),a.css("top")),a.turn("zoom",u).css({position:"absolute",margin:"",top:0,left:0});var o=a.offset();r.axis=s(o.left-l.left,o.top-l.top),f&&"double"==a.turn("display")&&("ltr"==a.turn("direction")&&!a.turn("view")[0]||"rtl"==a.turn("direction")&&!a.turn("view")[1])&&(r.axis.x+=a.width()/2),e.zoom("scroll",x),e.bind(t.mouseEvents.down,h._eMouseDown),e.bind(t.mouseEvents.move,h._eMouseMove),t(document).bind(t.mouseEvents.up,r.mouseupEvent),e.bind("mousewheel",h._eMouseWheel),setTimeout((function(){r.zoomer.hide(),r.zoomer.remove(),r.zoomer=null,r.zoomerView=null}),50)};return r.zoomer.css(d).show(),m?r.zoomer.bind(m,(function(){t(this).unbind(m),z()})):setTimeout(z,r.opts.duration),r.zoomer.transform(i(o.x,o.y,!0)+n(u,!0)),this},zoomOut:function(o){var e,r=this,a=this.data().zoom,u=a.opts.flipbook,l=1/a.scale,p=t.cssPrefix(),d=t.cssTransitionEnd();if(e=this.offset(),o=void 0!==o?o:a.opts.duration,a.zoomIn){var c=t.Event("zoom.change");if(this.trigger(c,[1]),c.isDefaultPrevented())return this;a.zoomIn=!1,a.scale=1,u.data().noCenter=!1,r.unbind(t.mouseEvents.down,h._eMouseDown),r.unbind(t.mouseEvents.move,h._eMouseMove),t(document).unbind(t.mouseEvents.up,a.mouseupEvent),r.unbind("mousewheel",h._eMouseWheel),(c={})[p+"transition"]=p+"transform "+a.opts.easeFunction+" "+o+"ms",u.css(c);var m=t("<div />",{css:{position:"relative",top:a.flipPosition.y,left:a.flipPosition.x,width:u.width()*l,height:u.height()*l,background:"blue"}}).appendTo(u.parent());c=s(m.offset().left-e.left,m.offset().top-e.top);m.remove();var f=u.data().opts.autoCenter;f&&"double"==u.turn("display")&&(u.turn("view")[0]?u.turn("view")[1]||(c.x="ltr"==u.turn("direction")?c.x+m.width()/4:c.x-m.width()/4):c.x="ltr"==u.turn("direction")?c.x-m.width()/4:c.x+m.width()/4);var g=t.findPos(u[0]);e=s(-u.width()/2-g.left+m.width()/2+c.x+e.left,-u.height()/2-g.top+m.height()/2+c.y+e.top);var v=function(){u[0].style.removeProperty?(u[0].style.removeProperty(p+"transition"),u.transform(u.turn("options").acceleration?i(0,0,!0):"").turn("zoom",1),u[0].style.removeProperty("margin"),u.css({position:"relative",top:a.flipPosition.y,left:a.flipPosition.x})):u.transform("none").turn("zoom",1).css({margin:"",top:a.flipPosition.y,left:a.flipPosition.x,position:"relative"}),f&&u.turn("center"),r.trigger("zoom.zoomOut")};return 0===o?v():(d?u.bind(d,(function(){t(this).unbind(d),v()})):setTimeout(v,o),u.transform(i(e.x,e.y,!0)+n(l,!0))),this}},flipbookWidth:function(){var t=this.data().zoom.opts.flipbook,o=t.turn("view");return"double"!=t.turn("display")||o[0]&&o[1]?t.width():t.width()/2},scroll:function(o,e,n){var r=this.data().zoom,u=r.opts.flipbook,h=this.zoom("flipbookWidth"),l=t.cssPrefix();if(a){var p={};p[l+"transition"]=n?l+"transform 200ms":"none",u.css(p),u.transform(i(-r.axis.x-o.x,-r.axis.y-o.y,!0))}else u.css({top:-r.axis.y-o.y,left:-r.axis.x-o.x});if(!e){var d;e=s(Math.min(0,(h-this.width())/2),Math.min(0,(u.height()-this.height())/2)),u=s(h>this.width()?h-this.width():(h-this.width())/2,u.height()>this.height()?u.height()-this.height():(u.height()-this.height())/2);o.y<e.y?(o.y=e.y,d=!0):o.y>u.y&&(o.y=u.y,d=!0),o.x<e.x?(o.x=e.x,d=!0):o.x>u.x&&(o.x=u.x,d=!0),d&&this.zoom("scroll",o,!0,!0)}r.scrollPos=s(o.x,o.y)},resize:function(){var t=this.data().zoom,o=t.opts.flipbook;if(1<this.zoom("value")){var e=o.offset(),i=this.offset();t.axis=s(e.left-i.left+(t.axis.x+t.scrollPos.x),e.top-i.top+(t.axis.y+t.scrollPos.y)),"double"==o.turn("display")&&"ltr"==o.turn("direction")&&!o.turn("view")[0]&&(t.axis.x+=o.width()/2),this.zoom("scroll",t.scrollPos)}},_eZoom:function(){for(var t=this.data().zoom,o=t.opts.flipbook,e=o.turn("view"),i=0;i<e.length;i++)e[i]&&this.trigger("zoom.resize",[t.scale,e[i],o.data().pageObjs[e[i]]])},_eStart:function(t){1!=this.zoom("value")&&t.preventDefault()},_eTurning:function(t,o,e){var i=this,n=(t=this.zoom("value"),this.data().zoom);o=n.opts.flipbook;if(n.page=o.turn("page"),1!=t){for(n=0;n<e.length;n++)e[n]&&this.trigger("zoom.resize",[t,e[n],o.data().pageObjs[e[n]]]);setTimeout((function(){i.zoom("resize")}),0)}},_eTurned:function(t,o){if(1!=this.zoom("value")){var e=this.data().zoom,i=e.opts.flipbook;o>e.page?this.zoom("scroll",s(0,e.scrollPos.y),!1,!0):o<e.page&&this.zoom("scroll",s(i.width(),e.scrollPos.y),!1,!0)}},_ePressed:function(){t(this).data().zoom.draggingCorner=!0},_eReleased:function(){var o=t(this).data().zoom;setTimeout((function(){o.draggingCorner=!1}),1)},_eMouseDown:function(o){return t(this).data().zoom.draggingCur=t.isTouch?s(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY):s(o.pageX,o.pageY),!1},_eMouseMove:function(o){var e=t(this).data().zoom;if(e.draggingCur){e.dragging=!0;o=t.isTouch?s(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY):s(o.pageX,o.pageY);var i=s(o.x-e.draggingCur.x,o.y-e.draggingCur.y);return t(this).zoom("scroll",s(e.scrollPos.x-i.x,e.scrollPos.y-i.y),!0),e.draggingCur=o,!1}},_eMouseUp:function(){var o=t(this).data().zoom;o.dragging&&t(this).zoom("scroll",o.scrollPos),o.draggingCur=null,setTimeout((function(){o.dragging=!1}),1)},_eMouseWheel:function(o,e,i,n){i=s((o=t(this).data().zoom).scrollPos.x+10*i,o.scrollPos.y-10*n),t(this).zoom("scroll",i,!1,!0)},_eTouchStart:function(o){var e=t(this).data().zoom;o=s(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY);e.touch={},e.touch.initial=o,e.touch.last=o,e.touch.timestamp=(new Date).getTime(),e.touch.speed=s(0,0)},_eTouchMove:function(o){var e=t(this).data().zoom,i=t(this).zoom("value"),n=e.opts.flipbook,r=(new Date).getTime();o=s(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY);e.touch&&1==i&&!n.data().mouseAction&&(e.touch.motion=s(o.x-e.touch.last.x,o.y-e.touch.last.y),e.touch.speed.x=0===e.touch.speed.x?e.touch.motion.x/(r-e.touch.timestamp):(e.touch.speed.x+e.touch.motion.x/(r-e.touch.timestamp))/2,e.touch.last=o,e.touch.timestamp=r)},_eTouchEnd:function(){var o=t(this).data().zoom;if(o.touch&&1==t(this).zoom("value")){var e=Math.abs(o.touch.initial.y-o.touch.last.y);50>e&&(-1>o.touch.speed.x||-100>o.touch.last.x-o.touch.initial.x)?this.trigger("zoom.swipeLeft"):50>e&&(1<o.touch.speed.x||100<o.touch.last.x-o.touch.initial.x)&&this.trigger("zoom.swipeRight")}},_eDestroying:function(){var o=this,e=this.data().zoom,i=e.opts.flipbook;for(var n in this.zoom("zoomOut",0),t.each("tap doubleTap resize zoomIn zoomOut swipeLeft swipeRight".split(" "),(function(t,e){o.unbind("zoom."+e)})),e.flipbookEvents)Object.prototype.hasOwnProperty.call(e.flipbookEvents,n)&&i.unbind(n,e.flipbookEvents[n]);i.unbind("touchstart",e.eventTouchStart).unbind("touchmove",e.eventTouchMove).unbind("touchend",e.eventTouchEnd),this.unbind("touchstart",h._tap).unbind("click",h._tap),e=null,this.data().zoom=null}};t.extend(t.fn,{zoom:function(){var o=arguments;if(!o[0]||"object"==typeof o[0])return h.init.apply(t(this[0]),o);if(h[o[0]])return h[o[0]].apply(t(this[0]),Array.prototype.slice.call(o,1));throw e(o[0]+" is not a method")}})}(jQuery);